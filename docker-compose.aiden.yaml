# docker-compose.aiden.yaml
# Pelian Open WebUI deployment for Aiden integration

services:
  open-webui:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - USE_SLIM=true
    image: pelian-open-webui:aiden
    container_name: pelian-open-webui
    env_file:
      - .env.aiden
    volumes:
      - pelian-webui-data:/app/backend/data
    ports:
      - "${WEBUI_PORT:-3000}:8080"
    environment:
      - "WEBUI_SECRET_KEY=${WEBUI_SECRET_KEY:-pelian-aiden-secret-change-me}"
      - "OLLAMA_BASE_URL=${OLLAMA_BASE_URL:-http://host.docker.internal:8080}"
      - "AIDEN_API_BASE_URL=${AIDEN_API_BASE_URL:-http://host.docker.internal:8000}"
      - "ENABLE_SIGNUP=${ENABLE_SIGNUP:-false}"
      - "ENABLE_ADMIN_EXPORT=true"
      - "AIOHTTP_CLIENT_SESSION_SSL=false"
      - "CORS_ALLOW_ORIGIN=*"
      - "FORWARDED_ALLOW_IPS=*"
      - "SCARF_NO_ANALYTICS=true"
      - "DO_NOT_TRACK=true"
      - "ANONYMIZED_TELEMETRY=false"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - pelian-net
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  pelian-net:
    external: true
    name: pelian-open-webui_pelian-net

volumes:
  pelian-webui-data:
